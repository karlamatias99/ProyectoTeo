<header class="header" id="header">
  <nav>
    <ul>
      <li>
        <a (click)="mostrarFormConversion()"
          ><img
            src="../../assets/img/tipo-de-cambio.png"
            alt="Icono Publicación"
            style="width: 30px; height: 30px"
          />Cambiar Moneda</a
        >
      </li>
      <li>
        <a (click)="mostrarPublish()">
          <img
            src="../../assets/img/anadir.png"
            alt="Icono Publicación"
            style="width: 30px; height: 30px"
          />
          Comprar</a
        >
      </li>
      <li>
        <a (click)="obtenerPublicacionesCompras()"
          ><img
            src="../../assets/img/publicacion.png"
            alt="Icono Publicación"
            style="width: 30px; height: 30px"
          />Publicar Compra</a
        >
      </li>
      <li>
        <a (click)="mostrarMonedas()"
          ><img
            src="../../assets/img/cacao.png"
            alt="Icono Publicación"
            style="width: 30px; height: 30px"
          />Mi Cuenta</a
        >
      </li>
      <li>
        <a (click)="cerrarSesion()"
          ><img
            src="../../assets/img/cerrar-sesion.png"
            alt="Icono Publicación"
            style="width: 30px; height: 30px"
          />Cerrar Sesión</a
        >
      </li>
    </ul>
  </nav>

  <div>
    <!-- Botón de carrito con número -->
    <button class="carrito-button" (click)="abrirVentana()">
      <img
        class="carrito"
        src="../../assets/img/anadir-al-carrito.png"
        alt=""
      />
      <!-- Número en burbuja -->
      <div class="numero-burbuja">{{ cantidadProductos }}</div>
    </button>
  </div>
  <form
    [formGroup]="searchForm"
    (ngSubmit)="buscarProducto()"
    class="formulario-busqueda"
  >
    <input
      type="text"
      formControlName="nombreProducto"
      placeholder="Ingrese el título de la publicación"
    />
    <button type="submit" class="boton-busqueda">Buscar</button>
  </form>
</header>

<div class="main">
  <!-- Contenedor de compra -->
  <div
    class="ventana-emergente"
    id="ventana"
    [style.display]="mostrarVentana ? 'block' : 'none'"
  >
    <div id="contenedorCompra" class="contenedorCompra">
      <div class="informacionCompra" id="informacionCompra">
        <h2>Tu Carrito</h2>
        <p class="x" id="x" (click)="cerrarVentanaCompra()">x</p>
      </div>
      <br />
      <div class="productosCompra" id="productosCompra">
        <!-- Mostrar productos del carrito -->
        <div
          *ngFor="let producto of lista; let i = index"
          class="productoCarrito"
        >
          <div class="img">
            <p>{{ producto.titulo_publicacion }}</p>
            <div style="margin-right: 80px">
              <!-- Contenedor para aplicar margen -->
              <p>&nbsp;&nbsp;&nbsp; Precio: Q{{ producto.precio_local }}</p>
              <p>
                &nbsp;&nbsp;&nbsp; Precio: {{ producto.precio_sistema }} cacaos
              </p>
              <!-- Precio dentro del contenedor -->
            </div>
            <img
              src="../../assets/img/borrar.png"
              (click)="eliminar(i)"
              class="botonTrash"
            />
          </div>
        </div>
        <div class="total" id="total">
          Total del carrito: {{ calcularTotalCarrito() }} cacaos
        </div>
      </div>

      <div class="botones">
        <button (click)="vaciarCarrito()">Vaciar Carrito</button>
        <button (click)="abrirVentanaTarjeta()">
          Ingresar Tarjeta Crédito/Débito
        </button>
        <button (click)="abrirFormularioPedido()">Finalizar Compra</button>
      </div>
    </div>
  </div>

  <!-- Publicaciones -->
  <div class="contenedorPublicacion" *ngIf="mostrarPublicaciones">
    <div *ngFor="let publicacion of publicaciones" class="tarjeta-publicacion">
      <h3>{{ publicacion.titulo_publicacion }}</h3>
      <img [src]="publicacion.imagen" />
      <p>{{ publicacion.descripcion }}</p>
      <!-- Mostrar precio y acciones según el tipo de publicación -->
      <ng-container *ngIf="publicacion.tipo_publicacion === 'Voluntariado'">
        <p>{{ "Fecha de Inicio: " + publicacion.fecha_inicio }}</p>
        <p>{{ "Fecha de Fin: " + publicacion.fecha_fin }}</p>
        <p>{{ "Remuneración: Q" + publicacion.remuneracion }}</p>
        <button (click)="aplicar(publicacion)" class="boton-con-imagen">
          <img src="../../assets/img/navegador-web.png" alt="Aplicar" />
        </button>
      </ng-container>
      <ng-container *ngIf="publicacion.tipo_publicacion === 'Venta'">
        <p>{{ "Precio Local: Q" + publicacion.precio_local }}</p>
        <p>{{ "Precio Sistema: " + publicacion.precio_sistema + " cacaos" }}</p>
        <button
          (click)="
            comprar(
              publicacion.id_publicacion,
              publicacion.titulo_publicacion,
              publicacion.imagen,
              publicacion.precio_local,
              publicacion.precio_sistema,
              publicacion.usuario_publicacion
            )
          "
          class="boton-con-imagen"
        >
          <img src="../../assets/img/anadir.png" alt="Comprar" />
        </button>
      </ng-container>
      <!-- Común a ambos tipos de publicación -->
      <button
        (click)="abrirVentanaEmergente(publicacion)"
        class="boton-con-imagen"
      >
        <img src="../../assets/img/chat.png" alt="Chat" />
      </button>
    </div>
  </div>

  <!-- Cambio de moneda -->
  <div class="contenedorConversionMoneda" *ngIf="mostrarFormularioConversion">
    <div class="container">
      <div class="card">
        <h2>Registrar Tarjeta</h2>
        <form
          [formGroup]="tarjetaForm"
          (submit)="registrarTarjeta()"
          class="form2"
          id="form"
        >
          <button class="proceed">
            <svg class="sendicon" width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"
              ></path>
            </svg>
          </button>

          <img
            src="https://seeklogo.com/images/V/VISA-logo-62D5B26FE1-seeklogo.com.png"
          />

          <label for="num_tarjeta">Número de Tarjeta:</label>
          <input
            type="text"
            formControlName="num_tarjeta"
            id="num_tarjeta"
            required
            class="input cardnumber"
            placeholder="**** **** **** ****"
          />

          <label for="nombre_usuario">Nombre de Usuario:</label>
          <input
            type="text"
            formControlName="nombre_usuario"
            id="nombre_usuario"
            required
            class="input name"
            placeholder="Nombre de Usuario de la Tarjeta"
          />

          <label for="vencimiento">Vencimiento:</label>
          <input
            type="date"
            formControlName="vencimiento"
            id="vencimiento"
            required
            class="input vencimiento"
          />

          <label for="cvv">CVV:</label>
          <input
            type="number"
            formControlName="cvv"
            id="cvv"
            required
            class="input ccv"
            placeholder="***"
          />
        </form>
        <button class="comprar-button" (click)="comprarCacaos()">
          <img src="../../assets/img/cacao.png" alt="Imagen" class="icono" />
          Comprar Cacaos
        </button>
      </div>
    </div>

    <div
      class="ventana-emergente"
      id="ventana"
      [style.display]="mostrarVentana ? 'block' : 'none'"
    >
      <div id="contenedorCompra" class="contenedorCompra">
        <div class="informacionCompra" id="informacionCompra">
          <h2>Tu Carrito</h2>
          <p class="x" id="x" (click)="cerrarVentanaCompra()">x</p>
        </div>
        <br />
        <div class="productosCompra" id="productosCompra">
          <!-- Mostrar productos del carrito -->
          <div
            *ngFor="let producto of lista; let i = index"
            class="productoCarrito"
          >
            <div class="img">
              <p>{{ producto.titulo_publicacion }}</p>
              <div style="margin-right: 80px">
                <!-- Contenedor para aplicar margen -->
                <p>&nbsp;&nbsp;&nbsp; Precio: Q{{ producto.precio_local }}</p>
                <p>
                  &nbsp;&nbsp;&nbsp; Precio:
                  {{ producto.precio_sistema }} cacaos
                </p>
                <!-- Precio dentro del contenedor -->
              </div>
              <img
                src="../../assets/img/borrar.png"
                (click)="eliminar(i)"
                class="botonTrash"
              />
            </div>
          </div>
          <div class="total" id="total">
            Total del carrito: {{ calcularTotalCarrito() }} cacaos
          </div>
        </div>

        <div class="botones">
          <button (click)="vaciarCarrito()">Vaciar Carrito</button>
          <button (click)="abrirVentanaTarjeta()">
            Ingresar Tarjeta Crédito/Débito
          </button>
          <button
            (click)="abrirVentanaPedido()"
            *ngIf="mostrarFormularioPedido"
          >
            Finalizar Compra
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Comprar -->
  <div class="contenedorPublicacion">
    <div class="publicar" *ngIf="showCompra">
      <h2>Que deseo Comprar</h2>
      <form
        [formGroup]="formPublicacion"
        (submit)="crearPublicacion()"
        class="form2"
        id="form"
      >
        <label>Titulo Publicacion</label>
        <input type="text" id="titulo" formControlName="titulo" />

        <label>Descripcion</label>
        <input type="text" id="descripcion" formControlName="descripcion" />

        <fieldset>
          <legend>Tipo Publicacion</legend>
          <label>
            <input
              type="radio"
              name="tipo_publicacion"
              value="Compra"
              checked="true"
              formControlName="tipo_publicacion"
            />
            <span style="color: #000000">Compra</span>
          </label>
          <label>
            <input
              type="radio"
              name="tipo_publicacion"
              value="Voluntariado"
              formControlName="tipo_publicacion"
            />
            <span style="color: #000000">Voluntariado</span>
          </label>
        </fieldset>
        <br />
        <label>Imagen</label>
        <input
          type="file"
          id="imagen"
          formControlName="imagen"
          accept="image/*"
        />

        <button>Ingresar Publicacion</button>
      </form>
    </div>
  </div>

  <!-- Mostrar que desea comprar el usuario -->
  <div class="contenedorPublicacion" *ngIf="mostrarQueComprar">
    <div *ngFor="let publicacion_compra of compras" class="tarjeta-publicacion">
      <h3>{{ publicacion_compra.titulo }}</h3>
      <img [src]="publicacion_compra.imagen" />
      <p>{{ publicacion_compra.descripcion }}</p>
      <p>{{ publicacion_compra.tipo_publicacion }}</p>
    </div>
  </div>

  <!-- Ventana emergente para comprar cacaos -->
  <div
    class="ventana-emergente"
    id="ventana"
    [style.display]="mostrarVentanaCompraCacaos ? 'block' : 'none'"
  >
    <div id="contenedorCompraCacaos" class="contenedorCompra">
      <div class="informacionCompra">
        <h2>Compra de Cacaos</h2>
        <p
          class="x"
          id="xCerrarCompraCacaos"
          (click)="cerrarVentanaCompraCacaos()"
        >
          x
        </p>
      </div>
      <br />
      <div class="productosCompra">
        <!-- Espacio para ingresar la cantidad de monedas -->
        <h2>Q1 equivale a 5 cacaos. Ejemplo: Q10 *5 = 50 cacaos</h2>
        <label for="cantidadMonedas">Dinero a cambiar:</label>

        <input
          type="number"
          id="cantidadAConvertir"
          name="cantidadAConvertir"
          [(ngModel)]="cantidadAConvertir"
        />

        <!-- Espacio para ingresar los detalles de la tarjeta -->
        <label for="num_tarjeta">Número de Tarjeta:</label>
        <input
          type="text"
          id="num_tarjeta"
          name="num_tarjeta"
          [(ngModel)]="num_tarjeta"
          required
        />

        <div class="botonesCompraCacaos">
          <!-- Botones para confirmar o cancelar la compra de cacaos -->
          <button (click)="comprarMonedas()">Comprar Cacaos</button>
          <button (click)="cerrarVentanaCompraCacaos()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mostrar monedas del usuario -->
  <div class="contenedorPublicacion" *ngIf="mostrarMonedasDiv">
    <div class="tarjeta-publicacion">
      <img src="../../assets/img/cacao.png" alt="Imagen" class="icono" />
      <p>Usuario: {{ usuario }}</p>
      <p>Cantidad: {{ MonedasUsuario }} Cacaos</p>
    </div>
  </div>

  <!-- Formulario para los datos del pedido -->
  <div
    class="ventana-emergente"
    id="ventana"
    [style.display]="mostrarFormularioPedido ? 'block' : 'none'"
    *ngIf="mostrarFormularioPedido"
  >
    <div id="contenedorCompra" class="contenedorCompra">
      <div class="informacionCompra" id="informacionCompra">
        <h2>Completa tus datos para finalizar la compra</h2>
        <p class="x" id="x" (click)="cerrarVentanaPedido()">x</p>
      </div>
      <br />
      <br />
      <div class="productosCompra" id="productosCompra">
        <form [formGroup]="pedidoForm">
          <label for="usuario_comprador">Usuario:</label>
          <input type="text" formControlName="usuario_comprador" required />
          <br />
          <label for="direccion">Dirección de envío:</label>
          <input type="text" formControlName="direccion" required />
          <br />
          <label for="telefono">Teléfono:</label>
          <input type="text" formControlName="telefono" required />
          <br />
          <button type="submit" (click)="finalizarCompra()">
            Confirmar pedido
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
